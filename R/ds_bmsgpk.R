bmsgpk <- function(cache){
  # author: Martin Benes
  
  # Download
  # https://www.data.gv.at/katalog/dataset/osterreichische-statistische-daten-zu-covid-19/resource/7ad666c7-663d-45dc-ae66-f61385c9eeba
  # Federal Ministery of Social Affairs, Health, Care and Consumer Protection, Austria (BMSGPK)
  url  <- "https://info.gesundheitsministerium.at/data/data.zip"
  url.deaths <- 'https://info.gesundheitsministerium.at/data/TodesfaelleTimeline.csv'
  
  temp <- tempfile()
  utils::download.file(url, temp, quiet = TRUE)
  
  # avaliable information
  zipped_filenames <- utils::unzip(temp, list=T)[,1]
  # AlgemeinDaten.csv - current situation
  # Altersverteilung.csv - numbers of confirmed by age
  # AltersverteilungTodesfaelle.csv - numbers of deaths by age
  # AltersverteilungTodesfaelleDemogr.csv - numbers of deaths by age (computed on demography???)
  # Bezirke.csv - current number of confirmed by district
  # Bundesland.csv - current number of confirmed by state
  # Epikurve.csv - confirmed by time
  # GenesenTimeline.csv - recovered by time
  # GenesenTodesFaelleBL.csv - current number of deaths and recovered by state
  # Geschlechtsverteilung.csv - number of confirmed (percentage) by gender
  # IBAuslastung.csv - occupancy of ICU beds by time
  # IBKapazitaeten.csv - capacity of ICU beds by time
  # NBAuslastung.csv - occupancy of normal beds by time
  # NBKapazitaeten.csv - capacity of normal beds by time
  # TodesfaelleTimeline.csv - deaths by time
  # VerstorbenGeschlechtsverteilung.csv - number of deaths (percentage) by gender
   
  # load data
  files <- c(
      "confirmed" = "Epikurve.csv", 
      # "deaths"    = "TodesfaelleTimeline.csv",
      "recovered" = "GenesenTimeline.csv", 
      "icu_pct"   = "IBAuslastung.csv",
      "hosp_pct"  = "NBAuslastung.csv")

  # deaths (removed from zip)
  deaths <- utils::read.csv(url.deaths, sep=";")
  x <- deaths[,1:2]
  colnames(x) <- c('date', 'deaths') 
  
  for(i in 1:length(files)){
    # file by file
    xx <- utils::read.csv(unz(temp, files[i]), sep=";") 
    xx <- xx[,1:2]
    colnames(xx) <- c('date', names(files[i])) 
    
    x <- merge(x, xx, all = T)
  }

  # date
  x$date <- as.Date(x$date, format="%d.%m.%Y")
  x <- x %>%
    dplyr::arrange(date)
  
  # turn confirmed to cumulative
  x$confirmed <- cumsum(x$confirmed)

  return(x)
}

